# 压力测试

## 物理机普通机型测试

测试条件

1.开启pipeline，不同连接数.

2.关闭pipeline，不同连接数

3.开启pipeline，不同Data size

测试脚本模板：

```
#!/bin/bash
for clients in {1,2,4,8,16,32,64,128,256,512,800}; do
echo $clients
redis-benchmark  -c $clients -n 5000000 -P 100 -h 10.10.214.139  -d 256 -t get,set -q
done
```

测试结果：

华北一可用区B

1.开启pipeline，不同连接数

```
redis-benchmark  -c $连接数 -n 5000000 -P 100 -h IP  -d 256 -t get,set
```

![image](/images/test_1.png)

2.关闭pipeline，不同连接数

```
redis-benchmark  -c $连接数 -n 1000000 -h IP -d 256 -t get,set -q
```

![image](/images/test_2.png)

3.开启pipeline，不同Data size

```
redis-benchmark -c 64 -n 5000000 -P 100 -h IP -d $字节 -t get,set -q
```

![image](/images/test_3.png)



## 快杰主备redis产品测试
### 测试环境
#### redis-server
软件版本：6.0

服务器机型：快杰版主备redis、物理机普通机型

产品规格：快杰1G、快杰2G、快杰4G、快杰6G、快杰8G、物理机普通机型

#### redis-benchmark
服务器机型： 快杰O型

系统版本：CentOS 8.3

机器配置：16C/16G

#### memtier_benchmark
服务器机型： 快杰O型

系统版本：CentOS 6.4

机器配置：16C/16G
### 测试场景
#### 1. 不同连接数，关闭pipeline
测试脚本：
```
#!/bin/bash
for clients in {1,2,4,8,16,32,64,128,256,512,800}; do
    redis-benchmark  -c $连接数 -n 1000000 -h IP -d 256 -t get,set -q --threads 4
done
```
##### 测试结果
Set性能<br />

| 连接数 | 1 | 2 | 4 | 8 | 16 | 32 | 64 | 128 | 256 | 512 | 800 |
| -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- |
| 快杰1G | 14118 | 26991 | 50571 | 83222 | 117619 | 137741 | 153822 | 166417 | 147819 | 153609 | 153421 |
| 快杰2G | 14067 | 27550 | 51986 | 85077 | 105241 | 142653 | 163671 | 142633 | 142612 | 153468 | 159565 |
| 快杰4G | 13921 | 28136 | 51221 | 84997 | 117495 | 142673 | 159769 | 159769 | 159846 | 159616 | 153421 |
| 快杰6G | 13921 | 27773 | 48711 | 85091 | 114116 | 142653 | 166334 | 166417 | 166361 | 153444 | 153444 |
| 快杰8G | 14068 | 27939 | 50568 | 86850 | 117495 | 142633 | 159744 | 159718 | 159872 | 159769 | 147819 |
| 物理机普通机型 | 8979 | 16774 | 28036 | 40722 | 52919 | 59917 | 64263 | 66813 | 68694 | 69101 | 72364 |

Get性能<br />

| 连接数 | 1 | 2 | 4 | 8 | 16 | 32 | 64 | 128 | 256 | 512 | 800 |
| -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- |
| 快杰1G | 16509 | 30972 | 58750 | 102438 | 153657 | 181587 | 210482 | 199720 | 199680 | 190258 | 199521 |
| 快杰2G | 15667 | 28951 | 57960 | 96880 | 142673 | 173671 | 189720 | 188680 | 180817 | 181827 | 192216 |
| 快杰4G | 16509 | 30733 | 57690 | 97880 | 142673 | 181620 | 199760 | 190367 | 190403 | 189760 | 192897 |
| 快杰6G | 16578 | 30709 | 57822 | 98427 | 142653 | 173671 | 190216 | 199680 | 195114 | 191587 | 212024 |
| 快杰8G | 16578 | 30815 | 59633 | 102553 | 142836 | 190222 | 210260 | 190186 | 199920 | 210128 | 209995 |
| 物理机普通机型 | 9973 | 19272 | 31571 | 47803 | 66246 | 86145 | 90371 | 90973 | 93531 | 95892 | 91907 |
##### 折线图
Set QPS <br />
![image](/images/set_qps_nopipeline.png)
Get QPS <br />
![image](/images/get_qps_nopipeline.png)

#### 2. 不同data size，关闭pipeline
测试脚本：
```
#!/bin/bash
for data_size in {1,8,64,512,4096}; do
    redis-benchmark -c 64 -n 1000000 -h IP -d $data_size -t get,set -q --threads 4
done
# 32KiB大小的data size长时间跑容易使1GB容量规格实例oom。
data_size=32768
redis-benchmark -c 64 -n 50000 -h IP -d $data_size -t get,set -q --threads 4
```
##### 测试结果
Set性能<br />

| 字节 | 1字节 | 8字节 | 64字节 | 512字节 | 4096字节 | 32768字节 |
| -- | -- | -- | -- | -- | -- | -- |
| 快杰1G | 173671 | 173852 | 166444 | 128998 | 66622 | 10748 |
| 快杰2G | 181521 | 173671 | 159769 | 137741 | 65449 | 12077 |
| 快杰4G | 181752 | 181587 | 173671 | 142816 | 61413 | 11659 |
| 快杰6G | 166417 | 159795 | 166472 | 147928 | 68922 | 11075 |
| 快杰8G | 181554 | 163609 | 152694 | 143657 | 66613 | 12676 |

Get性能<br />

| 字节 | 1字节 | 8字节 | 64字节 | 512字节 | 4096字节 | 32768字节 |
| -- | -- | -- | -- | -- | -- | -- |
| 快杰1G | 199680 | 190186 | 190439 | 190222 | 117467 | 11425 |
| 快杰2G | 199720 | 199960 | 199720 | 190186 | 117605 | 12028 |
| 快杰4G | 210260 | 199960 | 210216 | 199960 | 121036 | 13319 |
| 快杰6G | 199415 | 190222 | 199920 | 199680 | 117605 | 12519 |
| 快杰8G | 199920 | 181554 | 181554 | 181554 | 117481 | 14490 |
##### 折线图
Set QPS <br />
![image](images/set_bigdatasize_nopipeline.png)
Get QPS <br />
![image](images/get_bigdatasize_nopipeline.png)
#### 3. 不同连接数，开启pipeline
测试脚本：
```
#!/bin/bash
for clients in {1,2,4,8,16,32,64,128,256,512,800}; do
    redis-benchmark  -c $clients -n 5000000 -P 100 -h IP  -d 256 -t get,set -q --threads 4
done
```
##### 测试结果
Set性能<br />

| 连接数 | 1 | 2 | 4 | 8 | 16 | 32 | 64 | 128 | 256 | 512 | 800 |
| -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- |
| 快杰1G | 332933 | 487044 | 486854 | 524989 | 525430 | 525265 | 511561 | 498305 | 463907 | 433162 | 406471 |
| 快杰2G | 350434 | 475465 | 511823 | 539257 | 525430 | 511770 | 498454 | 511142 | 453391 | 424052 | 442712 |
| 快杰4G | 356709 | 475330 | 539548 | 539374 | 524824 | 511718 | 524989 | 511195 | 464037 | 443262 | 414593 |
| 快杰6G | 344400 | 475556 | 512242 | 525154 | 525320 | 538851 | 498902 | 511195 | 498256 | 423980 | 415006 |
| 快杰8G | 350459 | 487187 | 540073 | 539374 | 539723 | 554262 | 538793 | 511665 | 463520 | 433200 | 398883 |
| 物理机普通机型 | 137155 | 165579 | 182681 | 178424 | 189343 | 184836 | 195266 | 207331 | 202609 | 193318 | 190614 |

Get性能<br />

| 连接数 | 1 | 2 | 4 | 8 | 16 | 32 | 64 | 128 | 256 | 512 | 800 |
| -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- |
| 快杰1G | 665778 | 1174536 | 1537042 | 1662786 | 1537042 | 1663893 | 1532801 | 1533742 | 1424095 | 1532332 | 1421666 |
| 快杰2G | 644329 | 1109631 | 1535626 | 1663340 | 1663893 | 1662234 | 1534212 | 1661681 | 1534683 | 1423284 | 1328021 |
| 快杰4G | 645778 | 1174812 | 1537111 | 1606782 | 1663893 | 1661681 | 1662234 | 1662234 | 1662786 | 1533272 | 1532332 |
| 快杰6G | 645867 | 1051082 | 1663340 | 1665001 | 1665001 | 1711594 | 1661129 | 1660577 | 1661129 | 1532801 | 1531393 |
| 快杰8G | 644246 | 1174536 | 1665556 | 1663340 | 1663340 | 1661681 | 1533742 | 1533742 | 1535626 | 1533742 | 1423284 |
| 物理机普通机型 | 230075 | 406834 | 418795 | 475737 | 491980 | 498952 | 505152 | 542711 | 501705 | 501403 | 482020 |

##### 折线图
Set QPS <br />
![image](/images/set_qps_pipeline.png)
Get QPS <br />
![image](/images/get_qps_pipeline.png)
#### 4. 短链接压测
短链接的压测主要是测试在不同读写比例情况下不同规格redis产品的性能。<br />
测试脚本：
```
#!/bin/bash
memtier_benchmark -s IP -p 6379 -c 30 -t 8 -n 1000 --ratio=10:0 --reconnect-interval=1
memtier_benchmark -s IP -p 6379 -c 30 -t 8 -n 1000 --ratio=5:5 --reconnect-interval=1
memtier_benchmark -s IP -p 6379 -c 30 -t 8 -n 1000 --ratio=0:10 --reconnect-interval=1
```
##### 测试结果

| 读写比例 | 10:0 | 5:5 | 0:10 |
| -- | -- | -- | -- |
| 快杰1G | 29111 | 28039 | 28433 |
| 快杰2G | 27748 | 28136 | 27952 |
| 快杰4G | 28269 | 28190 | 27664 |
| 快杰6G | 27491 | 27870  | 28297 |
| 快杰8G | 28037 | 27965 | 27916 |

## 性能加强版redis产品测试

#### redis-server
软件版本：性能加强版redis

产品规格：4G、6G、8G、12G、16G、24G、32G、40G、48G、56G、64G

#### redis-benchmark
服务器机型： 快杰O型

系统版本：CentOS 8.3

机器配置：16C/16G

### 测试场景
#### 1. 不同连接数
测试脚本：
```
#!/bin/bash
for clients in {1,2,4,8,32,64,128,256,512,800}; do
    redis-benchmark -c $clients -n 10000000 -h IP -d 256 -t get,set -q --threads 8
done
```

#### 测试结果
Set性能<br />

| 连接数 | 1 | 2 | 4 | 8 | 32 | 64 | 128 | 256 | 512 | 800 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 多核主备4G | 18669 | 34442 | 55594 | 66216 | 193702 | 227917 | 230542 | 226623 | 223428 | 227855 |
| 多核主备6G | 18070 | 30221 | 58308 | 76917 | 200934 | 240934 | 232541 | 231197 | 232498 | 227195 |
| 多核主备8G | 19633 | 34442 | 64437 | 76913 | 195114 | 219770 | 218574 | 217386 | 217339 | 219712 |
| 多核主备12G | 19827 | 36993 | 65492 | 69315 | 157475 | 217386 | 220984 | 215049 | 204035 | 209929 |
| 多核主备16G | 19976 | 34891 | 66666 | 81457 | 191372 | 224709 | 224714 | 216202 | 218541 | 219702 |
| 多核主备24G | 20626 | 36619 | 63592 | 77058 | 176202 | 188675 | 228560 | 210508 | 220935 | 220945 |
| 多核主备32G | 17908 | 34013 | 56576 | 59622 | 200996 | 238083 | 239503 | 231203 | 228529 | 228503 |
| 多核主备40G | 20723 | 39170 | 69565 | 104437 | 155634 | 238089 | 248434 | 239503 | 235249 | 235244 |
| 多核主备48G | 17756 | 34071 | 61162 | 103358 | 178558 | 231203 | 245398 | 233912 | 227231 | 228508 |
| 多核主备56G | 18801 | 31629 | 60352 | 105680 | 190421 | 228169 | 233481 | 220526 | 237450 | 227863 |
| 多核主备64G | 18243 | 34441 | 60990 | 105259 | 123819 | 227252 | 249975 | 235271 | 238049 | 239440 |

Get性能<br />

| 连接数 | 1 | 2 | 4 | 8 | 32 | 64 | 128 | 256 | 512 | 800 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 多核主备4G | 20536 | 37313 | 68530 | 109436 | 240582 | 308875 | 336123 | 323881 | 326503 | 337478 |
| 多核主备6G | 20830 | 38940 | 74486 | 112037 | 238449 | 336123 | 333803 | 344815 | 330545 | 344768 |
| 多核主备8G | 22765 | 42552 | 73308 | 114933 | 229740 | 305334 | 319989 | 327847 | 340912 | 360321 |
| 多核主备12G | 23364 | 43903 | 82372 | 119753 | 189566 | 310048 | 317460 | 296269 | 350840 | 333500 |
| 多核主备16G | 23529 | 43287 | 76538 | 122319 | 224757 | 312490 | 322570 | 333311 | 319959 | 314891 |
| 多核主备24G | 23627 | 42685 | 79114 | 123449 | 249993 | 288089 | 322570 | 317450 | 320000 | 331071 |
| 多核主备32G | 20281 | 36788 | 74678 | 111724 | 264893 | 330567 | 360347 | 336111 | 347898 | 333277 |
| 多核主备40G | 24406 | 45195 | 72118 | 136050 | 240940 | 341868 | 360894 | 333151 | 384718 | 370329 |
| 多核主备48G | 20520 | 38527 | 65681 | 126982 | 170905 | 319989 | 357117 | 373775 | 344803 | 366864 |
| 多核主备56G | 20240 | 38379 | 69435 | 119383 | 212363 | 287728 | 330447 | 316876 | 306955 | 322242 |
| 多核主备64G | 20489 | 37374 | 72642 | 130288 | 170277 | 307654 | 325192 | 392354 | 385835 | 382252 |
#### 折线图
Set QPS <br />
![image](/images/highperformance_set_qps_diff_connect.png)
Get QPS <br />
![image](/images/highperformance_get_qps_diff_connect.png)

#### 2. 不同data size
测试脚本：
```
#!/bin/bash
for data_size in {16,32,64,128,256,512,1024,4096,8192,32768}; do
    redis-benchmark -c 200 -n 10000000 -h IP -d $data_size -t get,set -q --threads 8
done
```
#### 测试结果
Set性能<br />

| 字节 | 16字节 | 32字节 | 64字节 | 128字节 | 256字节 | 512字节 | 1024字节 | 4096字节 | 8192字节 | 32768字节 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 多核主备4G | 283679 | 277777 | 266666 | 263150 | 245380 | 228555 | 196070 | 92569 | 54021 | 11154 |
| 多核主备6G | 258044 | 248441 | 238083 | 233912 | 227267 | 201000 | 173148 | 72052 | 51250 | 12075 |
| 多核主备8G | 248428 | 243890 | 243896 | 231208 | 222207 | 198997 | 176984 | 86449 | 51261 | 11142 |
| 多核主备12G | 250000 | 246907 | 238083 | 233912 | 217381 | 203877 | 176199 | 84724 | 51929 | 13591 |
| 多核主备16G | 249993 | 245392 | 245380 | 235294 | 218569 | 203033 | 178568 | 72375 | 28745 | 11029 |
| 多核主备24G | 253158 | 243232 | 236680 | 231203 | 220974 | 200996 | 174657 | 73374 | 28560 | 12603 |
| 多核主备32G | 246181 | 254770 | 253158 | 239509 | 233907 | 210517 | 186901 | 91100 | 50614 | 12616 |
| 多核主备40G | 279696 | 255049 | 249770 | 259726 | 240952 | 206206 | 182638 | 77049 | 45433 | 12774 |
| 多核主备48G | 275854 | 270255 | 258057 | 248428 | 245386 | 216206 | 178565 | 55620 | 28563 | 11521 |
| 多核主备56G | 257552 | 243765 | 243415 | 246426 | 228107 | 224265 | 191850 | 76269 | 34022 | 11342 |
| 多核主备64G | 283679 | 277754 | 268434 | 273965 | 251553 | 220960 | 170189 | 87505 | 49980 | 12733 |

Get性能<br />

| 字节 | 16字节 | 32字节 | 64字节 | 128字节 | 256字节 | 512字节 | 1024字节 | 4096字节 | 8192字节 | 32768字节 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 多核主备4G | 373789 | 373803 | 373803 | 353932 | 360321 | 344827 | 230567 | 127761 | 55238 | 12623 |
| 多核主备6G | 341856 | 333322 | 363609 | 327858 | 336111 | 325192 | 246895 | 119770 | 55128 | 13313 |
| 多核主备8G | 366932 | 333311 | 300706 | 338948 | 330567 | 305324 | 235334 | 129787 | 55238 | 13316 |
| 多核主备12G | 333300 | 344791 | 336100 | 327847 | 317440 | 346945 | 227858 | 135846 | 53128 | 12620 |
| 多核主备16G | 341868 | 347814 | 333322 | 363609 | 319989 | 357130 | 227236 | 101338 | 54172 | 13340 |
| 多核主备24G | 350864 | 333322 | 309410 | 357142 | 330567 | 338948 | 227257 | 121634 | 55072 | 15540 |
| 多核主备32G | 363609 | 357091 | 380923 | 366945 | 353957 | 344803 | 230578 | 105306 | 52123 | 13324 |
| 多核主备40G | 372110 | 366023 | 349987 | 366306 | 316945 | 332547 | 240923 | 102012 | 55893 | 13944 |
| 多核主备48G | 342354 | 392126 | 330670 | 312126 | 322126 | 303789 | 277252 | 107623 | 56692 | 13231 |
| 多核主备56G | 338868 | 273815 | 327750 | 324580 | 298373 | 329924 | 279942 | 113973 | 57800 | 13211 |
| 多核主备64G | 399984 | 391022 | 412354 | 408129 | 404007 | 408129 | 304007 | 115576 | 57944 | 14436 |

#### 折线图
Set QPS <br />
![image](images/highperformance_set_qps_diff_valuesize.png)
Get QPS <br />
![image](images/highperformance_get_qps_diff_valuesize.png)